<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <script src="https://cdn.jsdelivr.net/npm/marked@3.0.7/marked.min.js"></script>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
        <!-- <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>     -->
        <div class="relative-container">
            <div id="toggle-container">
                <button id="dark-mode-toggle">Toggle Dark Mode</button>
            </div>
        </div>
             
        <title>AI Application</title>
        <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    
    </head>    
<body>
    <h1>Welcome to My AI Application</h1>        
    <!-- Display User Input and AI Response -->
    {% if user_input %}
    <div class="chat-container user-container">
        <div class="response user-input"><strong>You:</strong> {{ user_input }}</div>
        <img src="{{ url_for('static', filename='images/user.jpg') }}" alt="User Profile Photo" class="profile-image">
    </div>
    {% endif %}

    {% if ai_response %}
    <div class="chat-container response">
        <img src="{{ url_for('static', filename='images/ai.jpg') }}" alt="AI Profile Photo" class="profile-image">
        <div><strong>AI:</strong> {{ ai_response | safe }}</div>
    </div>
    {% endif %}

    {% if in_session %}
    <div class="chat-history">
        {% for message in messages %}
        <div class="chat-container {{ 'user-input' if message.is_user else 'response' }} {{ 'user-container' if message.is_user }}">
            {% if message.is_user %}
                <div class="response user-input"><strong>You:</strong> {{ message.content | safe }}</div>
                <img src="{{ url_for('static', filename='images/user.jpg') }}" alt="User Profile Photo" class="profile-image">
            {% else %}
                <img src="{{ url_for('static', filename='images/ai.jpg') }}" alt="AI Profile Photo" class="profile-image">
                <div><strong>AI:</strong> {{ message.content | safe }}</div>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% else %}
        <p>No active session. Click 'Start New Session' to begin.</p>
    {% endif %} 


    <!-- Loading Indicator -->
    <div id="loading" style="display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 20px; background: white; padding: 20px; border-radius: 5px; box-shadow: 0 0 10px rgba(0, 0, 0, 1);">
        Loading...
    </div>


    <form id="chat-form" action="/interact" method="post">
        <input type="text" name="user_input" placeholder="Type your message" id="user_input">
        <input type="button" value="Talk to AI" id="submit-btn">
    </form>
    <!-- File upload form -->
    <form id="upload-form" action="/interact" method="post" style="margin-top: 20px;">
        <input type="file" name="character_card" accept=".png" id="character_card">
        <button type="button" id="upload-submit-btn">Upload Character Card</button>
    </form>

    <div class="button-group">
        <!-- Buttons for session management -->
        <form action="/start_session" method="get">
            <input type="submit" value="Start New Session">
        </form>
        <form action="/end_session" method="get">
            <input type="submit" value="End Current Session">
        </form>
        <!-- Button to view past conversations -->
        <form action="/past_conversations">
            <input type="submit" value="View Past Conversations">
        </form>
    </div>
    <!-- Toggle Switch for Conscious Mode -->
    <!-- <label class="switch"> -->
    
    <div class="mode-toggle">
        <label>Conscious Mode: </label>
        <input type="checkbox" id="consciousModeToggle" value="Conscious Mode">
    </div>
    
    <div class="mode-toggle">
        <label>Work Mode:</label>
        <a href="/work_mode" id="workModeLink">Enter Work Mode</a>
    </div>
    
</body>
<script src="{{ url_for('static', filename='js/dark-mode-toggle.js') }}"></script>
<script src="{{ url_for('static', filename='js/chat-functions.js') }}"></script>
<!-- <script>
    document.getElementById('consciousModeToggle').addEventListener('change', function() {
    var isChecked = this.checked;
    // Disable Work Mode toggle when Conscious Mode is enabled
    $('#work-mode-toggle').prop('disabled', isChecked);

    fetch('/api/conscious_mode', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ enabled: isChecked }),
    })
    .then(response => response.json())
    .then(data => {
        console.log('Conscious Mode:', data.enabled ? 'Enabled' : 'Disabled');
        // Update Work Mode toggle based on Conscious Mode state
        if(data.enabled) {
            $('#work-mode-toggle').prop('checked', false);
        }
    })
    .catch((error) => {
        console.error('Error:', error);
    });
});

$(document).ready(function() {
    $('#work-mode-toggle').change(function() {
        const workModeEnabled = $(this).is(':checked');
        // Disable Conscious Mode toggle and Character Card upload if Work Mode is enabled
        $('#consciousModeToggle, #character_card').prop('disabled', workModeEnabled);

        $.ajax({
            type: "POST",
            url: "/api/work_mode",
            contentType: "application/json",
            data: JSON.stringify({ enabled: workModeEnabled }),
            success: function(response) {
                console.log("Work Mode:", response.enabled ? 'Enabled' : 'Disabled');
                // Update Conscious Mode toggle based on Work Mode state
                if(response.enabled) {
                    $('#consciousModeToggle').prop('checked', false);
                }
            },
            error: function(xhr, status, error) {
                console.error("Error toggling Work Mode:", error);
            }
        });
    });
});
    </script> -->

    <script>
        document.getElementById('consciousModeToggle').addEventListener('change', function() {
            var isChecked = this.checked;
            // Potentially disable or alert about Work Mode when Conscious Mode is enabled
            if (isChecked) {
                // Optionally, alert the user or take any action before redirecting to Work Mode
                // For example, display a message or disable a link
                alert('Conscious Mode is enabled. Work Mode will be unavailable.');
            }
        });
        
        $(document).ready(function() {
            // Assuming you want some interaction before going to Work Mode page
            $('#workModeLink').on('click', function(e) {
                // Check if Conscious Mode is enabled before redirecting
                var consciousModeEnabled = $('#consciousModeToggle').is(':checked');
                if (consciousModeEnabled) {
                    e.preventDefault(); // Prevent the link from being followed
                    alert('Please disable Conscious Mode before entering Work Mode.');
                } else {
                    // Optionally, perform any checks or set any states before redirecting
                    window.location.href = $(this).attr('href'); // Follow the link to Work Mode page
                }
            });
        });
        </script>
</html>